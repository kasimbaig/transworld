

<div class="naval-dashboard p-4 overflow-x-hidden">
  <!-- Dashboard Tabs - Positioned above the header -->
  <div class="command-header animate__animated animate__fadeIn" style="background: linear-gradient(135deg, rgba(41,66,112,0.95) 0%, rgba(85,127,201,0.95) 50%, rgba(124,177,247,0.95) 100%); backdrop-filter: blur(8px);">
    <div class="command-title-block">
      <div class="relative">
        <div class="absolute -inset-1 bg-white/20 rounded-full blur"></div>
      
      </div>
      <div class="relative">
        <div class="absolute -inset-1 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-lg blur-lg"></div>
        <h2 class="text-4xl font-extrabold tracking-tighter relative z-10" 
            style="color: white; text-shadow: 0 2px 8px rgba(0,0,0,0.4); letter-spacing: -0.025em;
                   background: linear-gradient(to right, #ffffff, #e0e7ff);
                   -webkit-background-clip: text;
                   -webkit-text-fill-color: transparent;">
          Dashboard
        </h2>
        <p class="text-xl mt-2 relative z-10" 
           style="color: rgba(255,255,255,0.95); text-shadow: 0 1px 4px rgba(0,0,0,0.2);">
          <i class="pi pi-chart-line mr-2 animate__animated animate__pulse animate__infinite"></i>
          Real-time monitoring and maintenance tracking
        </p>
      </div>
    </div>
    <div class="command-actions">
      <button pButton icon="pi pi-cog" 
              class="p-button-rounded p-button-text p-button-xl hover:bg-white/20 transition-all duration-300 transform hover:scale-110 relative group" 
              style="color: white; border: 2px solid rgba(255,255,255,0.4); box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
        <span class="absolute -inset-1 bg-white/30 rounded-full blur-sm opacity-0 group-hover:opacity-100 transition-opacity"></span>
      </button>
    </div>
  </div>

  <!-- Dashboard Content -->
  <div class="dashboard-container w-full max-w-full" *ngIf="activeTab === 'dashboard'">
    <!-- Simple KPI Cards Section -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8">
      <div class="bg-white rounded-lg shadow p-4 border border-gray-200" *ngFor="let metric of kpiMetrics">
        <div class="flex items-center mb-2">
          <i class="pi mr-2" [ngClass]="metric.iconClass" [style.color]="metric.iconColor || '#4f46e5'"></i>
          <span class="text-sm font-medium text-gray-600">{{ metric.title }}</span>
        </div>
        <h2 class="text-2xl font-bold mb-2">{{ metric.value }}</h2>
        <div *ngIf="metric.trendPercentage" class="text-xs">
          <span [ngClass]="{
            'text-green-600': metric.trendDirection === 'up',
            'text-red-600': metric.trendDirection === 'down',
            'text-gray-600': metric.trendDirection === 'neutral'
          }">
            {{ metric.trendPercentage }}
          </span>
        </div>
      </div>
    </div>

    <div class="charts-section w-full max-w-full mt-4">
      <div class="chart-container">
        <app-opdef [command]="selectedCommand !== null ? selectedCommand.toString() : null"
          [ship]="selectedShip !== null ? selectedShip.toString() : null"
          [dept]="selectedDept !== null ? selectedDept.toString() : null" [dateRange]="dateRange"></app-opdef>
      </div>
      <div class="chart-container">
        <app-frequent-defects [chartData]="frequentDefectData"></app-frequent-defects>
      </div>
    </div>

    <div class="bg-white p-6 rounded-xl shadow-lg w-full max-w-full border border-gray-100">
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            Maritime Command Center
          </h2>
          <p class="text-sm text-gray-500 mt-1">Operational Status Dashboard</p>
        </div>
        <div class="space-x-3">
          <button pButton icon="pi pi-plus" label="Report Issue" 
                  class="p-button-rounded p-button-outlined p-button-primary shadow-md hover:shadow-lg transition-all" 
                  (click)="addNewDefect()"></button>
          <button pButton icon="pi pi-book" label="Record Service" 
                  class="p-button-rounded p-button-outlined p-button-secondary shadow-md hover:shadow-lg transition-all"
                  (click)="logMaintenance()"></button>
        </div>
      </div>
      
      <div class="overflow-x-auto">
        <table class="w-full table-auto">
          <thead>
            <tr class="bg-gradient-to-r from-blue-50 to-purple-50">
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Vessel Name</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Combat Readiness</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Systems Status</th>
              <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Current Status</th>
            </tr>
          </thead>
          <tbody>
            <tr class="hover:bg-gray-50 transition-colors border-b">
              <td class="px-6 py-4 font-medium">INS Virat</td>
              <td class="px-6 py-4 w-1/3">
                <div class="flex flex-col gap-1">
                  <p-progressBar [value]="95" [showValue]="false" 
                               styleClass="bg-emerald-400 h-3 rounded-full"></p-progressBar>
                  <div class="flex justify-between text-xs">
                    <span class="text-green-600 font-medium">95%</span>
                    <span class="text-gray-500">Target: 100%</span>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex gap-2">
                  <span class="px-3 py-1 rounded-full bg-green-100 text-green-800">Weapons ✓</span>
                  <span class="px-3 py-1 rounded-full bg-green-100 text-green-800">Radar ✓</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-green-500"></span>
                  <span class="px-4 py-2 rounded-full bg-gradient-to-r from-green-100 to-green-200 text-green-700 font-medium">
                    Mission Ready
                  </span>
                </div>
              </td>
            </tr>
            <tr class="hover:bg-gray-50 transition-colors border-b">
              <td class="px-6 py-4 font-medium">INS Chennai</td>
              <td class="px-6 py-4 w-1/3">
                <div class="flex flex-col gap-1">
                  <p-progressBar [value]="78" [showValue]="false"
                               styleClass="custom-progress-bar h-3 rounded-full"></p-progressBar>
                  <div class="flex justify-between text-xs">
                    <span class="text-yellow-600 font-medium">78%</span>
                    <span class="text-gray-500">Target: 100%</span>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex gap-2">
                  <span class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-800">Weapons ⚠</span>
                  <span class="px-3 py-1 rounded-full bg-green-100 text-green-800">Radar ✓</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-yellow-500"></span>
                  <span class="px-4 py-2 rounded-full bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-700 font-medium">
                    Partial Ops
                  </span>
                </div>
              </td>
            </tr>
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-6 py-4 font-medium">INS Delhi</td>
              <td class="px-6 py-4 w-1/3">
                <div class="flex flex-col gap-1">
                  <p-progressBar [value]="45" [showValue]="false"
                               styleClass="custom-progress-bar h-3 rounded-full"></p-progressBar>
                  <div class="flex justify-between text-xs">
                    <span class="text-red-600 font-medium">45%</span>
                    <span class="text-gray-500">Target: 100%</span>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex gap-2">
                  <span class="px-3 py-1 rounded-full bg-red-100 text-red-800">Weapons ⚠</span>
                  <span class="px-3 py-1 rounded-full bg-red-100 text-red-800">Radar ⚠</span>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <span class="w-2 h-2 rounded-full bg-red-500"></span>
                  <span class="px-4 py-2 rounded-full bg-gradient-to-r from-red-100 to-red-200 text-red-700 font-medium">
                    In Repairs
                  </span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>



<!-- Dialogs -->

<!-- Add New Defect Dialog using Reusable Form -->
<app-add-form
  *ngIf="showDefectsFormDialog"
  [open]="showDefectsFormDialog"
  [formConfig]="defectsFormConfig"
  [formData]="newDefect"
  [fromTitle]="'Add New Defect'"
  [submitLabel]="'Submit Defect'"
  (onOpenChange)="showDefectsFormDialog = $event"
  (onSubmit)="handleDefectsFormSubmit($event)"
></app-add-form>

<!-- Log Maintenance Dialog -->
<p-dialog header="Log Maintenance Activity" [(visible)]="showLogMaintenanceDialog"
  [style]="{width: '650px', maxWidth: '90vw'}" styleClass="custom-dialog"
  [breakpoints]="{'960px': '75vw', '640px': '90vw'}" [contentStyle]="{'max-height': '80vh', 'overflow': 'auto'}">

  <div class="dialog-content p-fluid p-formgrid p-grid p-3 gap-3">
    <!-- Maintenance Type -->
    <div class="p-field p-col-12 p-md-6">
      <label for="maintenanceType" class="p-text-bold">Maintenance Type <span class="required-asterisk">*</span></label>
      <p-dropdown inputId="maintenanceType" [options]="maintenanceTypeOptions"
        [(ngModel)]="maintenanceLog.maintenanceType" placeholder="Select Type" optionLabel="label" optionValue="value"
        [required]="true" styleClass="drop"></p-dropdown>
    </div>

    <!-- Maintenance Frequency -->
    <div class="p-field p-col-12 p-md-6">
      <label for="maintenanceFrequency" class="p-text-bold">Frequency <span class="required-asterisk">*</span></label>
      <p-dropdown inputId="maintenanceFrequency" [options]="maintenanceFrequencyOptions"
        [(ngModel)]="maintenanceLog.frequency" placeholder="Select Frequency" optionLabel="label" optionValue="value"
        [required]="true" styleClass="drop"></p-dropdown>
    </div>

    <div class="p-field p-col-12 p-md-6">
      <label for="maintenanceTask" class="p-text-bold">Task Title <span class="required-asterisk">*</span></label>
      <input id="maintenanceTask" type="text" class="border-2 border-gray-500 rounded-sm bg-white" pInputText [(ngModel)]="maintenanceLog.task"
        placeholder="e.g., Daily engine inspection" style="width: 100%;" [required]="true" />
    </div>


    <!-- Equipment -->
    <div class="p-field p-col-12 p-md-6">
      <label for="maintenanceEquipment" class="p-text-bold">Equipment/System <span
          class="required-asterisk">*</span></label>
      <p-dropdown inputId="maintenanceEquipment" [options]="equipmentOptions" [(ngModel)]="maintenanceLog.equipment"
        placeholder="Select Equipment/System" optionLabel="label" optionValue="value" [required]="true"
        styleClass="drop"></p-dropdown>
    </div>

    <!-- Assigned Personnel -->
    <div class="p-field p-col-12 p-md-6">
      <label for="assignedPersonnel" class="p-text-bold">Assigned Personnel <span
          class="required-asterisk">*</span></label>
      <p-dropdown inputId="assignedPersonnel" [options]="personnelOptions"
        [(ngModel)]="maintenanceLog.assignedPersonnel" placeholder="Select Personnel" optionLabel="label"
        optionValue="value" [required]="true" styleClass="drop"></p-dropdown>
    </div>

    <!-- Hours Spent -->
    <div class="p-field p-col-12 p-md-6">
      <label for="maintenanceHours" class="p-text-bold">Hours Spent <span class="required-asterisk">*</span></label>
      <p-inputNumber id="maintenanceHours" class="p-inputtext" [(ngModel)]="maintenanceLog.hours" placeholder="e.g., 8"
        style="width: 100%;" mode="decimal" [required]="true"></p-inputNumber>
    </div>

    <!-- Date of Completion -->
    <div class="p-field p-col-12 p-md-6">
      <label for="completionDate" class="p-text-bold">Date of Completion <span
          class="required-asterisk">*</span></label>
      <p-calendar id="completionDate" [(ngModel)]="maintenanceLog.completionDate" [readonlyInput]="true"
        dateFormat="dd/mm/yy" [required]="true" styleClass="drop"></p-calendar>
    </div>

    <!-- Spares Used -->
    <div class="p-field p-col-12">
      <label for="sparesUsed" class="p-text-bold">Spares Used (Comma Separated)</label>
      <textarea id="sparesUsed" pInputTextarea rows="2" [(ngModel)]="maintenanceLog.sparesUsed"
        placeholder="e.g., Filter A, Gasket B"></textarea>
    </div>

    <!-- Remarks / Feedback -->
    <div class="p-field p-col-12">
      <label for="maintenanceRemarks" class="p-text-bold">Remarks / Feedback</label>
      <textarea id="maintenanceRemarks" pInputTextarea rows="3" [(ngModel)]="maintenanceLog.remarks"
        placeholder="Any additional notes or observations."></textarea>
    </div>
  </div>

  <!-- Footer -->
  <ng-template pTemplate="footer">
    <div class="footer-actions">
      <button pButton label="Cancel" icon="pi pi-times" class="p-button-secondary p-button-text"
        (click)="showLogMaintenanceDialog = false"></button>
      <button pButton label="Submit Log" icon="pi pi-check" class="p-button-primary"
        (click)="submitMaintenanceLog()"></button>
    </div>
  </ng-template>

</p-dialog>

<!-- Equipment Fit Dialog -->
<p-dialog header="View Equipment Fit" [(visible)]="showEquipmentFitDialog" [style]="{ width: '80vw' }"
  styleClass="custom-dialog" [modal]="true" [closable]="true">

  <div class="equipment-fit-view">
    <div class="p-fluid p-formgrid p-grid p-3 gap-3 mb-4">
      <div class="p-field p-col-12 p-md-6">
        <label for="efCommand" class="p-text-bold">Command</label>
        <p-dropdown inputId="efCommand" [options]="(commands$ | async) ?? []" [(ngModel)]="selectedEFCommand"
          placeholder="Select Command" optionLabel="label" optionValue="value" [showClear]="true"></p-dropdown>
      </div>
      <div class="p-field p-col-12 p-md-6">
        <label for="efShip" class="p-text-bold">Ship</label>
        <p-dropdown inputId="efShip" [options]="filteredShips" [(ngModel)]="selectedEFShip" placeholder="Select Ship"
          optionLabel="label" optionValue="value" [showClear]="true"></p-dropdown>
      </div>
    </div>

    <p-table [value]="equipmentList" styleClass="p-datatable-sm custom-table" [responsiveLayout]="'scroll'"
      scrollHeight="60vh">

      <ng-template pTemplate="header">
        <tr>
          <th style="min-width: 200px;">🔧 Equipment Name</th>
          <th style="min-width: 150px;">📦 NSN/Part No.</th>
          <th style="min-width: 120px;">🏢 Department</th>
          <th style="min-width: 120px;">🚢 Compartment</th>
          <th style="min-width: 150px;">📋 Status</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-equip>
        <tr>
          <td>{{ equip.name }}</td>
          <td>{{ equip.nsn || equip.partNumber || 'N/A' }}</td>
          <td>{{ equip.department || 'N/A' }}</td>
          <td>{{ equip.compartment || 'N/A' }}</td>
          <td>
            <span class="badge status-badge" [ngClass]="getStatusClassd(equip.status)">
              {{ equip.status }}
            </span>
          </td>
        </tr>
      </ng-template>
      <!-- Add placeholder if table data is empty -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="p-text-center">
            <div class="table-placeholder">
              <i class="pi pi-database"></i>
              <p>No equipment fit data available for selected filters.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <ng-template pTemplate="footer">
    <div style="display: flex; justify-content: flex-end;">
      <button pButton label="Close" icon="pi pi-times" class="p-button-text p-button-secondary"
        (click)="showEquipmentFitDialog = false">
      </button>
    </div>
  </ng-template>
</p-dialog>

<!-- Approve Plan Dialog -->
<p-dialog header="Approve Maintenance Plan" [(visible)]="showApprovePlanDialog" [style]="{ width: '800px' }"
  styleClass="custom-dialog" [modal]="true" [closable]="true">

  <div class="approval-content p-fluid p-formgrid p-grid p-3 gap-3">
    <p class="p-col-12" style="margin-bottom: 1rem;">Please review the details of the maintenance plan before proceeding
      with approval or rejection:</p>

    <div class="maintenance-plan-summary p-col-12 p-mb-4">
      <p><strong>🆔 Plan ID:</strong> MP-2023-045</p>
      <p><strong>🚢 Ship:</strong> INS Vikrant</p>
      <p><strong>🗓 Proposed Date:</strong> 2025-07-15 to 2025-07-20</p>
      <p><strong>📝 Total Tasks:</strong> 18</p>
      <p><strong>⏱ Estimated Hours:</strong> 120</p>
      <p><strong>🧑‍🔧 Responsible Dept.:</strong> Engineering</p>
    </div>

    <!-- Approver Comments -->
    <div class="p-field p-col-12">
      <label for="approverComments" class="p-text-bold">Reviewer Comments</label>
      <textarea id="approverComments" pInputTextarea rows="4" [(ngModel)]="approverComments"
        placeholder="Add comments regarding the plan, approval, or rejection reasons."></textarea>
    </div>

    <!-- Approval Status (if applicable, read-only for current action) -->
    <div class="p-field p-col-12 p-md-6" *ngIf="false"> <!-- Example of conditional field -->
      <label for="approvalStatus" class="p-text-bold">Current Status</label>
      <input id="approvalStatus" type="text" pInputText value="Pending Review" [readOnly]="true" class="border-2 border-gray-500 rounded-sm bg-white"
        style="width:100%" />
    </div>

    <!-- Approver's Name (auto-filled) -->
    <div class="p-field p-col-12 p-md-6" *ngIf="false"> <!-- Example of auto-filled field -->
      <label for="approverName" class="p-text-bold">Approver</label>
      <input id="approverName" type="text" pInputText value="CAPT. J. Smith" [readOnly]="true" class="border-2 border-gray-500 rounded-sm bg-white"
        style="width:100%" />
    </div>

  </div>

  <ng-template pTemplate="footer">
    <div class="p-d-flex p-jc-end p-ai-center p-gap-2 p-px-3 pb-2">
      <button pButton label="Reject" icon="pi pi-times-circle" class="p-button-danger p-button-outlined"
        (click)="showApprovePlanDialog = false">
      </button>
      <button pButton label="Approve" icon="pi pi-check-circle" class="p-button-success"
        (click)="approveMaintenancePlan()">
      </button>
    </div>
  </ng-template>
</p-dialog>