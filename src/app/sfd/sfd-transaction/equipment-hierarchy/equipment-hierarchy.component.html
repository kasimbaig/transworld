<div class="container mx-auto p-6">
    <!-- Header -->
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Equipment <span class="text-orange-500">Hierarchy List</span></h2>
        <div class="h-1 w-20 bg-blue-600 rounded"></div>
    </div>

    <!-- Dropdown Filters -->
    <div class=" rounded-lg shadow-md p-6 mb-6 border border-gray-200 bg-slate-100">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <!-- Unit Dropdown -->
            <div class="flex items-center gap-4">
                <label class="text-sm font-bold text-gray-700 w-20 flex-shrink-0">Unit Type</label>
                <p-dropdown 
                    [options]="unitTypeOptions" 
                    [(ngModel)]="selectedUnitType"
                    placeholder="--Select Unit Type--"
                    optionLabel="name"
                    [filter]="true"
                    filterBy="name"
                    (onChange)="onUnitTypeChange()"
                    styleClass="flex-1">
                </p-dropdown>
            </div>

            <!-- Ship Name Dropdown -->
            <div class="flex items-center gap-4">
                <label class="text-sm font-bold text-gray-700 w-20 flex-shrink-0">Ship Name</label>
                <p-dropdown 
                    [options]="shipOptions" 
                    [(ngModel)]="selectedShip"
                    placeholder="--Select Ship--"
                    optionLabel="name"  
                    [filter]="true"
                    filterBy="name"
                    [disabled]="!selectedUnitType"
                    (onChange)="onShipChange()"
                    styleClass="flex-1">
                </p-dropdown>
            </div>
            
            <!-- Department Dropdown -->
            <div class="flex items-center gap-4">
                <label class="text-sm font-bold text-gray-700 w-20 flex-shrink-0">Department</label>
                <p-dropdown 
                    [options]="departmentOptions" 
                    [(ngModel)]="selectDepartment"
                    placeholder="--Select Department--"
                    optionLabel="name"  
                    [filter]="true"
                    filterBy="name"
                    (onChange)="onDepartmentChange()"
                    styleClass="flex-1">
                </p-dropdown>
            </div>
        </div>
    </div>

    <!-- Equipment Hierarchy Table using PrimeNG -->
    <p-table [value]="tableData" 
             [paginator]="true" 
             #dt
             showGridlines="true"
             [rows]="10" 
             [showCurrentPageReport]="true"
             currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
             [rowsPerPageOptions]="[10, 25, 50]"
             styleClass="p-datatable-sm"
             [globalFilterFields]="['nomenclature', 'equipment_code', 'equipment_name', 'malntop_no', 'location_onboard', 'no_of_fits', 'current_child', 'parent_equipment']">

        <ng-template pTemplate="caption">
            <div class="flex justify-between items-center p-4 bg-amber-100  rounded ">
                <div class="flex items-center gap-3">
                    <div class="w-1 h-8 bg-blue-600 rounded-full"></div>
                    <h5 class="text-xl font-semibold text-slate-800 m-0">Equipment Hierarchy</h5>
                </div>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="pi pi-search text-slate-400"></i>
                    </div>
                    <input type="text" 
                        class="pl-10 pr-4 py-2.5 w-80 border border-slate-300 bg-white rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 placeholder-slate-400" 
                        [(ngModel)]="searchValue"
                        (input)="dt.filterGlobal(onSearchInput(searchValue), 'contains')" 
                        placeholder="Search equipment, codes, names..." />
                </div>
            </div>
        </ng-template>
        
        <ng-template pTemplate="header">
            <tr>
                <th pSortableColumn="rowIndex" class="bg-slate-700 text-white">
                    <p-sortIcon field="rowIndex"></p-sortIcon>
                    S.No.
                </th>     
                 <th pSortableColumn="nomenclature" class="bg-slate-700 text-white">
                    <p-sortIcon field="nomenclature"></p-sortIcon>
                    Nomenclature
                    <p-columnFilter type="text"  field="nomenclature" display="menu" />

                </th>
                <th pSortableColumn="equipment_code" class="bg-slate-700 text-white">
                    <p-sortIcon field="equipment_code"></p-sortIcon>
                    Equipment Code
                    <p-columnFilter type="text"   field="equipment_code" display="menu" />
                    
                </th>
                <th pSortableColumn="equipment_name" class="bg-slate-700 text-white">
                    <p-sortIcon field="equipment_name"></p-sortIcon>
                    Equipment Name
                    <p-columnFilter type="text"  field="equipment_name" display="menu" />

                </th>
                <th pSortableColumn="malntop_no" class="bg-slate-700 text-white">
                    <p-sortIcon field="malntop_no"></p-sortIcon>
                    Maintop No.
                    <p-columnFilter type="text"  field="malntop_no" display="menu" />

                </th>
          
                <th pSortableColumn="location_onboard" class="bg-slate-700 text-white">
                    <p-sortIcon field="location_onboard"></p-sortIcon>
                    Location On board
                    <p-columnFilter type="text"  field="location_onboard" display="menu" />

                </th>
                <th pSortableColumn="no_of_fits" class="bg-slate-700 text-white">
                    <p-sortIcon field="no_of_fits"></p-sortIcon>
                    No of Fits
                    <p-columnFilter type="text"  field="no_of_fits" display="menu" />

                </th>
                <th pSortableColumn="current_child" class="bg-slate-700 text-white">
                    <p-sortIcon field="current_child"></p-sortIcon>
                    Current/Child
                    <p-columnFilter type="text"  field="current_child" display="menu" />

                </th>
                <th pSortableColumn="parent_equipment" class="bg-slate-700 text-white">
                    <p-sortIcon field="parent_equipment"></p-sortIcon>
                    Parent Equipment
                    <p-columnFilter type="text"  field="parent_equipment" display="menu" />

                </th>
                <th>Actions</th>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-item let-rowIndex="rowIndex">
            <tr [class.bg-gray-50]="rowIndex % 2 === 1"  
            class="py-2"    >
            <td>{{rowIndex + 1}}</td>
                <td>{{ item.nomenclature || '-' }}</td>
                <td>{{ item.equipment_code || '-' }}</td>
                <td>{{ item.equipment_name || '-' }}</td>
                <td>{{ item.malntop_no || '-' }}</td>
                <td>{{ item.location_onboard || '-' }}</td>
                <td>{{ item.no_of_fits || '-' }}</td>
               
                <td>
                    <p-dropdown 
                        [options]="[{label: 'Current', value: 'current'}, {label: 'Child', value: 'child'}]" 
                        [(ngModel)]="item.current_child"
                        placeholder="Select"
                        optionLabel="label"
                        optionValue="value"
                        styleClass="w-full">
                    </p-dropdown>
                </td>
                <td>
                    <p-dropdown 
                        [options]="tableData" 
                        [(ngModel)]="item.parent_equipment"
                        placeholder="Select Parent"
                        optionLabel="equipment_name"
                        optionValue="equipment_code"
                        [filter]="true"
                        filterBy="equipment_name"
                        styleClass="w-full">
                    </p-dropdown>
                </td>
                <td class="px-4 py-3 text-center">
                    <button mat-button [matMenuTriggerFor]="actionsMenu"   class="px-3 py-1.5 bg-blue-600 text-red-600  rounded-md hover:bg-blue-700 transition-colors duration-200">
                        <small>Actions</small>
                    </button>
                    <mat-menu #actionsMenu="matMenu" class="shadow-lg border border-gray-200 rounded-md">
                        <!-- <button  mat-menu-item 
                            class="flex items-center justify-start gap-3 px-4 py-3 w-full hover:bg-blue-50 text-blue-600 hover:text-blue-800 transition-colors duration-200">
                            <i class="fa-solid fa-eye text-blue-500 w-4 h-4 flex-shrink-0"></i>
                            <span class="text-sm font-medium">View</span>
                        </button> -->
                
                        <button  mat-menu-item 
                            class="flex items-center justify-start gap-3 px-4 py-3 w-full hover:bg-green-50 text-green-600 hover:text-green-800 transition-colors duration-200">
                            <i class="fa-solid fa-pen-to-square text-green-500 w-4 h-4 flex-shrink-0"></i>
                            <span class="text-sm font-medium">Update</span>
                        </button>
                    </mat-menu>
                </td>
            </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
            <tr>
                <td colspan="10" class="text-center py-8 text-gray-500">
                    <div class="bg-white rounded-lg shadow-md p-8 text-center">
                        <div class="flex flex-col items-center justify-center py-12">
                            <i class="pi pi-inbox text-6xl text-gray-400 mb-4"></i>
                            <h3 class="text-xl font-semibold text-gray-600 mb-2">No Records Found</h3>
                            <p class="text-gray-500">There are no equipment hierarchy records available at the moment.</p>
                        </div>
                    </div>
                </td>
            </tr>
        </ng-template>
    </p-table>

</div>