<div class="flex justify-end gap-2 mb-4 absolute top-4 right-60 z-10 no-print print-buttons">
  <button  
    printSectionId="printsection"	[openNewTab]="true"
    ngxPrint  styleSheetFile="assets/print.css"
    class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors duration-200 flex items-center gap-2"
    >
    <i class="pi pi-file-pdf"></i>
    PDF
  </button>
  <button 
    class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors duration-200 flex items-center gap-2"
    (click)="downloadWord()">
    <i class="pi pi-file-word"></i>
    Word
  </button>
  <button 
    class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition-colors duration-200 flex items-center gap-2"
    (click)="downloadExcel()">
    <i class="pi pi-file-excel"></i>
    Excel
  </button>
  <button 
    class="px-4 py-2 bg-orange-500 text-white rounded hover:bg-orange-500 transition-colors duration-200 flex items-center gap-2"
    (click)="openCustomizer()">
    <i class="pi pi-file-pdf"></i>
    Custom Table
  </button>
</div>



<!-- Header Section -->
<div class="mb-6 text-center relative avoid-break" #printsection id="printsection" >
  <div class="text-3xl font-bold text-red-700 mb-2 text-center">INDIAN NAVAL SHIP MAINTENANCE AUTHORITY</div>
  <div class="text-2xl font-semibold text-blue-900 mb-4 text-center">{{ reportSubHeading  }}</div>
  <div class="text-lg font-medium text-gray-700 mb-2  absolute top-10 right-5 z-10">Date :{{date}} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Time : {{time}}</div>
  
<div>
  <!-- Report Parameters Display -->
  <table class="w-full border border-gray-400 avoid-break">
    <tr class="bg-gray-100">
      <ng-container *ngFor="let header of reportData | keyvalue">
        <td *ngIf="header.value" class="border border-gray-400 p-2">
          <span class="font-semibold text-blue-700">{{ header.key }} :&nbsp; </span>
          <span class="text-gray-800">{{ getobject(header.value) }}</span>
        </td>
      </ng-container>
     
    </tr>
  </table>
</div>
<div class="overflow-x-auto">
<table border="1" class="table-auto w-full text-center border-collapse tborder overflow-x-auto">
    <thead>
      <tr *ngFor="let headerRow of renderHeaderRows.length ? renderHeaderRows : headerRows; let rowIndex = index; trackBy: trackByIndex" 
          [class]="'header-row-' + rowIndex"
          [ngClass]="{
            'bg-blue-900 text-white font-bold text-lg': rowIndex === 0,
            'bg-blue-700 text-white font-semibold': rowIndex === 1,
            'bg-blue-500 text-white': rowIndex === 2
          }">
        <ng-container *ngFor="let col of headerRow; trackBy: trackByHeader">
          <th [attr.rowspan]="col.rowspan || null" 
              [attr.colspan]="col.colspan || null"
              class="border border-gray-400 p-2 text-center tborder">
            {{ col.label }}
          </th>
        </ng-container>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let item of tableData; let itemIndex = index; trackBy: trackByIndex">
        <ng-container *ngFor="let nestedItem of getNestedArray(item); let i = index; trackBy: trackByIndex">
          <tr [ngClass]="{'bg-gray-50': (itemIndex + i) % 2 === 0, 'bg-white': (itemIndex + i) % 2 !== 0}"
              class="hover:bg-blue-50 transition-colors">
            
            <ng-container *ngFor="let header of (visibleDataColumns.length ? visibleDataColumns : dataColumns); let colIndex = index; trackBy: trackByHeader">
              <td *ngIf="header.source === 'main' && i === 0" 
                  [attr.rowspan]="getNestedArrayLength(item)"
                  [class]="getCellClasses(header, colIndex) +'tborder'">
                {{ getDataValue(item, nestedItem, header) }}
              </td>
              
              <td *ngIf="header.source === 'nested'" 
                  [class]="getCellClasses(header, colIndex) +'tborder'">
                {{ getDataValue(item, nestedItem, header) }}
              </td>
            </ng-container>
            
          </tr>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
</div>
</div>


<!-- Simple modal for column customization -->
<div *ngIf="showCustomizer" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class=" rounded shadow-lg w-full max-w-6xl bg-amber-50">
    <div class="flex items-center justify-between mb-3 bg-blue-950 text-white p-3">
      <h3 class="text-lg font-semibold">Customize columns</h3>
      <button class="text-white hover:text-gray-200 " (click)="closeCustomizer()">âœ•</button>
    </div>

    <!-- <div class="flex gap-2 mb-3 p-2">
      <button class="px-3 py-1 bg-blue-600 text-white rounded" (click)="selectAllColumns()">Select all</button>
      <button class="px-3 py-1 bg-gray-200 rounded" (click)="clearAllColumns()">Clear all</button>
    </div> -->
      <div class="px-4 pb-3">
        <div class="max-h-80 overflow-y-auto border rounded p-3 grid grid-cols-1 md:grid-cols-2 gap-2">
          <label *ngFor="let col of dataColumns; trackBy: trackByHeader" class="flex items-center gap-2 bg-blue-50 border-1 rounded-md p-2 m-1">
            <input type="checkbox" [(ngModel)]="columnSelectionMap[col.selectionId]" (ngModelChange)="toggleColumn(col.selectionId, $event)" />
            <span class="ml-2" >{{ col.label }}</span>
          </label>
        </div>

        <div class="mt-4 text-right">
          <button class="px-4 py-2 bg-green-600 text-white rounded" (click)="closeCustomizer()">Apply</button>
        </div>
      </div>
   
  </div>
  
</div>
